<mujoco model="robot_arm_gripper">
  <compiler angle="radian" coordinate="local" inertiafromgeom="true"/>
  
  <option timestep="0.002" gravity="0 0 -9.81">
    <flag warmstart="enable"/>
  </option>
  
  <visual>
    <rgba haze="0.15 0.25 0.35 1"/>
    <quality shadowsize="2048"/>
    <map stiffness="700" shadowscale="0.5" fogstart="10" fogend="15" zfar="40" haze="0.3"/>
  </visual>
  
  <asset>
    <texture type="skybox" builtin="gradient" rgb1="0.3 0.5 0.7" rgb2="0 0 0" width="512" height="512"/>
    <texture name="texplane" type="2d" builtin="checker" rgb1=".2 .3 .4" rgb2=".1 0.15 0.2" width="512" height="512" mark="cross" markrgb=".8 .8 .8"/>
    <material name="matplane" reflectance="0.3" texture="texplane" texrepeat="1 1" texuniform="true"/>
  </asset>
  
  <default>
    <joint damping="0.5" armature="0.01"/>
    <geom condim="3" friction="1 0.005 0.0001" solimp="0.9 0.95 0.001" solref="0.02 1"/>
  </default>
  
  <worldbody>
    <light directional="true" diffuse=".8 .8 .8" specular="0.3 0.3 0.3" pos="0 0 5" dir="0 0 -1"/>
    <light directional="true" diffuse=".6 .6 .6" specular="0.2 0.2 0.2" pos="1 1 4" dir="-1 -1 -1"/>
    
    <!-- Ground plane (make collidable) -->
    <geom name="floor" pos="0 0 0" size="0 0 0.05" type="plane" material="matplane"
          contype="1" conaffinity="1" mass="1000" friction="1 0.005 0.0001" solimp="0.9 0.95 0.001" solref="0.02 1"/>
    
    <!-- Table -->
    <body name="table" pos="0.5 0 0">
      <geom name="table_top" type="box" size="0.4 0.4 0.02" pos="0 0 0.4"
            rgba="0.6 0.4 0.2 1" contype="1" conaffinity="1" mass="10"
            friction="1 0.005 0.0001" solimp="0.9 0.95 0.001" solref="0.02 1"/>
      <geom name="table_leg1" type="cylinder" size="0.02 0.19" pos="0.35 0.35 0.19"
            rgba="0.6 0.4 0.2 1" contype="1" conaffinity="1" mass="2"/>
      <geom name="table_leg2" type="cylinder" size="0.02 0.19" pos="0.35 -0.35 0.19"
            rgba="0.6 0.4 0.2 1" contype="1" conaffinity="1" mass="2"/>
      <geom name="table_leg3" type="cylinder" size="0.02 0.19" pos="-0.35 0.35 0.19"
            rgba="0.6 0.4 0.2 1" contype="1" conaffinity="1" mass="2"/>
      <geom name="table_leg4" type="cylinder" size="0.02 0.19" pos="-0.35 -0.35 0.19"
            rgba="0.6 0.4 0.2 1" contype="1" conaffinity="1" mass="2"/>
    </body>
    
    <!-- Cube to be grasped - placed on table -->
    <body name="cube" pos="0.5 0 0.4475">
      <joint name="cube_free" type="free" damping="0.5"/>
      <geom name="cube_geom" type="box" size="0.025 0.025 0.025" rgba="1 0 0 1"
            mass="0.05" friction="1.5 0.005 0.0001" solimp="0.99 0.99 0.001" solref="0.01 1"
            contype="1" conaffinity="1"/>
      <site name="cube_center" pos="0 0 0" size="0.01"/>
    </body>
    
    <!-- Robot Arm Base - positioned on table surface near cube
         nudged slightly up to avoid initial overlap -->
    <body name="base" pos="0.5 0.3 0.461">
      <geom name="base_geom" type="cylinder" size="0.05 0.02" rgba="0.3 0.3 0.3 1"
            mass="1" contype="1" conaffinity="1" friction="1 0.005 0.0001"/>
      
      <!-- Link 1 (shoulder rotation) -->
      <body name="link1" pos="0 0 0.02">
        <joint name="shoulder_pan" type="hinge" axis="0 0 1" range="-3.14 3.14" damping="1.0" armature="0.1"/>
        <geom name="link1_geom" type="cylinder" size="0.03 0.1" rgba="0.2 0.4 0.8 1"
              mass="0.5" contype="1" conaffinity="1"/>
        
        <!-- Link 2 (shoulder lift) -->
        <body name="link2" pos="0 0 0.1">
          <joint name="shoulder_lift" type="hinge" axis="0 1 0" range="-1.57 1.57" damping="1.0" armature="0.1"/>
          <geom name="link2_geom" type="capsule" fromto="0 0 0 0 0 0.2" size="0.025" rgba="0.2 0.6 0.8 1"
                mass="0.4" contype="1" conaffinity="1"/>
          
          <!-- Link 3 (elbow) -->
          <body name="link3" pos="0 0 0.2">
            <joint name="elbow" type="hinge" axis="0 1 0" range="-2.5 2.5" damping="0.5" armature="0.05"/>
            <geom name="link3_geom" type="capsule" fromto="0 0 0 0 0 0.15" size="0.02" rgba="0.2 0.7 0.8 1"
                  mass="0.3" contype="1" conaffinity="1"/>
            
            <!-- Link 4 (wrist) -->
            <body name="link4" pos="0 0 0.15">
              <joint name="wrist" type="hinge" axis="0 0 1" range="-3.14 3.14" damping="0.3" armature="0.02"/>
              <geom name="link4_geom" type="cylinder" size="0.02 0.03" rgba="0.3 0.3 0.3 1"
                    mass="0.2" contype="1" conaffinity="1"/>
              
              <!-- Gripper base and Option A hinge gripper -->
              <body name="gripper_base" pos="0 0 0.05">
                <geom name="gripper_base_geom" type="box" size="0.02 0.03 0.01" rgba="0.5 0.5 0.5 1"
                      mass="0.1" contype="1" conaffinity="1"/>

                <site name="gripper_site" pos="0 0 0.04" size="0.01"/>

                <!-- Left finger (hinge) -->
                <body name="left_finger" pos="0 0.03 0.01">
                  <!-- hinge axis points so closing rotates inward toward -y -->
                  <joint name="left_finger_hinge" type="hinge" axis="0 0 1" range="-1.57 0" damping="0.5" armature="0.001"/>
                  <!-- finger link -->
                  <geom name="left_finger_link" type="capsule" fromto="0 0 0 0 -0.04 0" size="0.01"
                        rgba="0.2 0.8 0.2 1" contype="1" conaffinity="1" mass="0.02"
                        friction="2.5 0.005 0.0001" solimp="0.99 0.99 0.001" solref="0.01 1"/>
                  <!-- rounded fingertip pad -->
                  <geom name="left_finger_pad" type="sphere" pos="0 -0.045 0" size="0.012"
                        rgba="0.15 0.6 0.15 1" contype="1" conaffinity="1" mass="0.002"
                        friction="4 0.005 0.0001" solimp="0.99 0.999 0.001" solref="0.005 1"/>
                  <site name="left_tip_site" pos="0 -0.045 0" size="0.005"/>
                </body>

                <!-- Right finger (hinge) -->
                <body name="right_finger" pos="0 -0.03 0.01">
                  <!-- hinge mirrored; closing rotates inward toward +y -->
                  <joint name="right_finger_hinge" type="hinge" axis="0 0 1" range="0 1.57" damping="0.5" armature="0.001"/>
                  <geom name="right_finger_link" type="capsule" fromto="0 0 0 0 0.04 0" size="0.01"
                        rgba="0.2 0.8 0.2 1" contype="1" conaffinity="1" mass="0.02"
                        friction="2.5 0.005 0.0001" solimp="0.99 0.99 0.001" solref="0.01 1"/>
                  <geom name="right_finger_pad" type="sphere" pos="0 0.045 0" size="0.012"
                        rgba="0.15 0.6 0.15 1" contype="1" conaffinity="1" mass="0.002"
                        friction="4 0.005 0.0001" solimp="0.99 0.999 0.001" solref="0.005 1"/>
                  <site name="right_tip_site" pos="0 0.045 0" size="0.005"/>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>
  
  <actuator>
    <motor name="shoulder_pan_motor" joint="shoulder_pan" gear="50" ctrllimited="true" ctrlrange="-1 1"/>
    <motor name="shoulder_lift_motor" joint="shoulder_lift" gear="50" ctrllimited="true" ctrlrange="-1 1"/>
    <motor name="elbow_motor" joint="elbow" gear="30" ctrllimited="true" ctrlrange="-1 1"/>
    <motor name="wrist_motor" joint="wrist" gear="20" ctrllimited="true" ctrlrange="-1 1"/>
    <!-- Gripper actuators: hinge motors for Option A -->
    <motor name="left_finger_motor" joint="left_finger_hinge" gear="40" ctrllimited="true" ctrlrange="-1 1"/>
    <motor name="right_finger_motor" joint="right_finger_hinge" gear="40" ctrllimited="true" ctrlrange="-1 1"/>
  </actuator>
  
  <sensor>
    <jointpos name="shoulder_pan_pos" joint="shoulder_pan"/>
    <jointvel name="shoulder_pan_vel" joint="shoulder_pan"/>
    <jointpos name="shoulder_lift_pos" joint="shoulder_lift"/>
    <jointvel name="shoulder_lift_vel" joint="shoulder_lift"/>
    <jointpos name="elbow_pos" joint="elbow"/>
    <jointvel name="elbow_vel" joint="elbow"/>
    <jointpos name="wrist_pos" joint="wrist"/>
    <jointvel name="wrist_vel" joint="wrist"/>

    <!-- sensors for new gripper joints -->
    <jointpos name="left_finger_pos" joint="left_finger_hinge"/>
    <jointvel name="left_finger_vel" joint="left_finger_hinge"/>
    <jointpos name="right_finger_pos" joint="right_finger_hinge"/>
    <jointvel name="right_finger_vel" joint="right_finger_hinge"/>

    <framepos name="gripper_pos" objtype="site" objname="gripper_site"/>
    <framequat name="gripper_quat" objtype="site" objname="gripper_site"/>
    <framepos name="cube_pos" objtype="site" objname="cube_center"/>
    <framequat name="cube_quat" objtype="site" objname="cube_center"/>
  </sensor>
  
  <contact>
    <!-- Keep immediate-adjacent self-collision excludes (prevents link self-collisions).
         These do NOT disable robot <-> environment contacts. -->
    <exclude body1="base" body2="link1"/>
    <exclude body1="link1" body2="link2"/>
    <exclude body1="link2" body2="link3"/>
    <exclude body1="link3" body2="link4"/>
    <exclude body1="link4" body2="gripper_base"/>
    <exclude body1="gripper_base" body2="left_finger"/>
    <exclude body1="gripper_base" body2="right_finger"/>
    <exclude body1="left_finger" body2="right_finger"/>
  </contact>
  
  <equality>
    <!-- Mirror the two gripper hinges so they move symmetrically (left + right = 0) -->
    <joint joint1="left_finger_hinge" joint2="right_finger_hinge" polycoef="0 1 1 0 0"/>
  </equality>
</mujoco>
